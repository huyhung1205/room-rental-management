@model Project_65133295.Areas.Admin.Data.RoomFormViewModel_65133295

@{
    ViewBag.Title = "Add New Room";
    ViewBag.PageTitle = "Add New Room";
    ViewBag.PageDescription = "Set up information for a new rental room";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="max-w-5xl mx-auto">
    @using (Html.BeginForm("CreateRoom", "Admin_65133295", FormMethod.Post, new { enctype = "multipart/form-data", id = "roomForm" }))
    {
        @Html.AntiForgeryToken()
        if (!ViewData.ModelState.IsValid)
        {
            @Html.ValidationSummary(false, "", new { @class = "mb-6 p-4 bg-red-50 border-l-4 border-red-400 text-red-700 rounded-xl text-sm font-medium shadow-sm" })
        }

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Main Info -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Basic Info Card -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        <span class="w-8 h-8 bg-yellow-100 text-primary-dark rounded-lg flex items-center justify-center mr-3 text-sm">01</span>
                        Basic Information
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Room Number <span class="text-red-500">*</span></label>
                            @Html.TextBoxFor(m => m.RoomNumber, new { @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all", placeholder = "E.g: 101, A202..." })
                            @Html.ValidationMessageFor(m => m.RoomNumber, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>
                        
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Listing Title <span class="text-red-500">*</span></label>
                            @Html.TextBoxFor(m => m.Title, new { @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all", placeholder = "Name displayed on search results" })
                            @Html.ValidationMessageFor(m => m.Title, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Monthly Rent (VND) <span class="text-red-500">*</span></label>
                            @Html.TextBox("Price", Model.Price.ToString("0.##", System.Globalization.CultureInfo.InvariantCulture), new { @type = "number", @min = "0", @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all", placeholder = "E.g: 3500000" })
                            @Html.ValidationMessageFor(m => m.Price, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Area (m²) <span class="text-red-500">*</span></label>
                            @Html.TextBox("Area", Model.Area.HasValue ? Model.Area.Value.ToString("0.##", System.Globalization.CultureInfo.InvariantCulture) : "", new { @type = "number", @step = "0.01", @min = "0", @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all", placeholder = "E.g: 25.5" })
                            @Html.ValidationMessageFor(m => m.Area, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>

                        <div class="md:col-span-2 space-y-2">
                            <label class="text-sm font-bold text-gray-700">Detailed Description</label>
                            @Html.TextAreaFor(m => m.Description, new { @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all min-h-[120px]", placeholder = "Additional room info, rules..." })
                        </div>
                    </div>
                </div>

                <!-- Utilities Card -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        <span class="w-8 h-8 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center mr-3 text-sm">02</span>
                        Room Amenities
                    </h3>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        @for (int i = 0; i < Model.Utilities.Count; i++)
                        {
                            <label class="relative flex items-center p-3 rounded-xl border border-gray-100 bg-gray-50 hover:bg-white hover:border-primary cursor-pointer transition-all group">
                                @Html.HiddenFor(m => m.Utilities[i].UtilityID)
                                @Html.HiddenFor(m => m.Utilities[i].UtilityName)
                                @Html.CheckBoxFor(m => m.Utilities[i].IsSelected, new { @class = "w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary transition" })
                                <span class="ml-3 text-sm font-medium text-gray-700 group-hover:text-primary-dark">@Model.Utilities[i].UtilityName</span>
                            </label>
                        }
                    </div>
                </div>

                <!-- Images Card -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        <span class="w-8 h-8 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mr-3 text-sm">03</span>
                        Room Images
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-200 rounded-2xl cursor-pointer bg-gray-50 hover:bg-gray-100 hover:border-primary transition-all relative overflow-hidden">
                                <div class="flex flex-col items-center justify-center py-4">
                                    <svg class="w-8 h-8 mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    <p class="text-xs text-gray-500 font-bold">Add Room Photos</p>
                                </div>
                                <input type="file" name="NewImages" id="imageInput" multiple class="hidden" accept="image/*" />
                            </label>
                        </div>
                        
                        <div id="imagePreview" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4">
                            <!-- JS will inject previews here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Settings -->
            <div class="space-y-6">
                <!-- Status & Location Card -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 sticky top-8">
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-6">System Settings</h3>
                    
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Current Status</label>
                            @Html.DropDownListFor(m => m.StatusID, new SelectList(Model.Statuses, "StatusID", "StatusName"), new { @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary appearance-none bg-no-repeat bg-[right_1rem_center] transition-all", style="background-image: url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 fill%3D%22none%22 viewBox%3D%220 0 20 20%22%3E%3Cpath stroke%3D%22%236b7280%22 stroke-linecap%3D%22round%22 stroke-linejoin%3D%22round%22 stroke-width%3D%221.5%22 d%3D%22m6 8 4 4 4-4%22%2F%3E%3C%2Fsvg%3E')" })
                            @Html.ValidationMessageFor(m => m.StatusID, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>

                        <div class="space-y-2 hidden">
                            <label class="text-sm font-bold text-gray-700">Building Location</label>
                            @Html.HiddenFor(m => m.AddressID)
                            @Html.ValidationMessageFor(m => m.AddressID, "", new { @class = "text-xs text-red-500 font-medium" })
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-bold text-gray-700">Maximum Occupancy</label>
                            @Html.TextBoxFor(m => m.MaxOccupancy, new { @type = "number", @min = "0", @class = "block w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-1 focus:ring-primary focus:border-primary transition-all", placeholder = "Default: 2" })
                        </div>

                        <div class="pt-6 border-t border-gray-50 flex flex-col gap-3">
                            <button type="submit" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-xl shadow-sm text-sm font-bold text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                Save Information
                            </button>
                            <a href="@Url.Action("ManageRooms")" class="w-full flex justify-center items-center py-3 px-4 border border-gray-200 rounded-xl text-sm font-bold text-gray-600 bg-white hover:bg-gray-50 transition-all">
                                Cancel
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="bg-yellow-50 rounded-2xl p-6 border border-yellow-100">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-primary-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-bold text-primary-dark">Important Notes When Creating Rooms</h3>
                            <div class="mt-2 text-xs text-yellow-700 leading-relaxed">
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>The first image uploaded will be selected as the main thumbnail.</li>
                                    <li>Room number is unique and cannot be duplicated.</li>
                                    <li>Clear descriptions will help attract customers better.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section scripts {
    <script>
        // Image preview logic
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        let selectedFiles = [];

        imageInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            // Filter and process new files
            files.forEach(file => {
                if (!file.type.startsWith('image/')) return;
                
                // Add to our internal tracking
                selectedFiles.push(file);
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const div = document.createElement('div');
                    div.className = "relative h-24 rounded-lg overflow-hidden border border-gray-200 shadow-sm group";
                    div.id = `preview-${selectedFiles.length - 1}`;
                    div.innerHTML = `
                        <img src="${event.target.result}" class="w-full h-full object-cover" />
                        <button type="button" onclick="removeImage(${selectedFiles.length - 1})" class="absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                        <div class="absolute bottom-1 left-1 bg-primary text-[8px] font-bold px-1 rounded text-white uppercase">Mới</div>
                    `;
                    imagePreview.appendChild(div);
                    updateInputFiles();
                };
                reader.readAsDataURL(file);
            });
        });

        function removeImage(index) {
            selectedFiles[index] = null; // Mark as null to keep index sync
            document.getElementById(`preview-${index}`).remove();
            updateInputFiles();
        }

        function updateInputFiles() {
            const dataTransfer = new DataTransfer();
            selectedFiles.forEach(file => {
                if (file) dataTransfer.items.add(file);
            });
            imageInput.files = dataTransfer.files;
        }
    </script>
}
